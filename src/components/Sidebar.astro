---
import WeatherToggle from './WeatherToggle.astro';
import { ChevronDown, ChevronUp } from '@lucide/astro';
import packageJson from '../../package.json';

const version = packageJson.version;
const repoUrl = typeof packageJson.repository === 'string' 
  ? packageJson.repository 
  : packageJson.repository?.url || '';
---
<div id="sidebar-overlay" class="fixed inset-0 z-[90] hidden bg-transparent"></div>

<aside
	id="site-sidebar"
	role="dialog"
	aria-modal="true"
	aria-labelledby="site-sidebar-title"
	tabindex="-1"
	class="fixed inset-y-0 right-0 z-[100] h-full w-56 sm:w-64 bg-[var(--color-sidebar-bg)] text-[var(--color-text)] border-l border-white/10 transform translate-x-full transition-transform duration-300 ease-out motion-reduce:transition-none motion-reduce:transform-none overflow-hidden font-mono flex flex-col"
>
	<h2 id="site-sidebar-title" class="sr-only">Site navigation</h2>
	<nav class="flex flex-col gap-0.5 px-4 pt-3 pb-4 sm:px-5 sm:pt-4 sm:pb-6 grow overflow-y-auto">
		<a href="/" class="group block rounded-md px-4 py-2 text-sm sm:text-base font-medium text-[var(--color-text)] transition-colors hover:text-[var(--color-brand)]"><span class="squiggle-underline">home</span></a>
		<a href="/stuckers" class="group block rounded-md px-4 py-2 text-sm sm:text-base font-medium text-[var(--color-text)] transition-colors hover:text-[var(--color-brand)]"><span class="squiggle-underline">stuckers</span></a>
		<a href="https://ombi.crapshack.net" target="_blank" rel="noopener noreferrer" class="group block rounded-md px-4 py-2 text-sm sm:text-base font-medium text-[var(--color-text)] transition-colors hover:text-[var(--color-brand)]"><span class="squiggle-underline">plex requests</span></a>
		<a href="https://plex.crapshack.net" target="_blank" rel="noopener noreferrer" class="group block rounded-md px-4 py-2 text-sm sm:text-base font-medium text-[var(--color-text)] transition-colors hover:text-[var(--color-brand)]"><span class="squiggle-underline">plex</span></a>

		<div class="mt-auto space-y-1">
			<details class="collapsible group/collapsible flex flex-col-reverse rounded-md text-[var(--color-text)] bg-white/5">
			<summary class="group/summary flex items-center justify-between cursor-pointer rounded-md px-4 py-2 text-sm text-white/60 hover:text-[var(--color-brand)] select-none list-none [&::-webkit-details-marker]:hidden">
				<span>apps</span>
				<span aria-hidden="true" class="text-white/50 transition-colors group-hover/summary:text-[var(--color-brand)]">
					<ChevronDown class="block group-open/collapsible:hidden" size={14} stroke-width={2} />
					<ChevronUp class="hidden group-open/collapsible:block" size={14} stroke-width={2} />
				</span>
			</summary>
			<div class="collapsible-content grid grid-rows-[0fr] transition-[grid-template-rows] duration-200 ease-out">
					<div class="overflow-hidden">
						<div class="mb-1 space-y-1 pl-2">
							<a href="/crapdash" class="group block rounded-md px-4 py-2 text-sm sm:text-base font-medium text-[var(--color-text)] transition-colors hover:text-[var(--color-brand)]">
								<span class="inline-flex items-center gap-2">
									<img src="/images/crapdash/compy.png" alt="" aria-hidden="true" class="h-4 w-4 rounded-md" loading="lazy" />
									<span class="squiggle-underline">crapdash</span>
								</span>
							</a>
							<a href="/bitdream" class="group block rounded-md px-4 py-2 text-sm sm:text-base font-medium text-[var(--color-text)] transition-colors hover:text-[var(--color-brand)]">
								<span class="inline-flex items-center gap-2">
									<img src="/images/bitdream/bitdream.png" alt="" aria-hidden="true" class="h-4 w-4 rounded-md" loading="lazy" />
									<span class="squiggle-underline">bitdream</span>
								</span>
							</a>
							<a href="/stuckers-app" class="group block rounded-md px-4 py-2 text-sm sm:text-base font-medium text-[var(--color-text)] transition-colors hover:text-[var(--color-brand)]">
								<span class="inline-flex items-center gap-2">
									<img src="/images/stuckers/stuckers-icon.png" alt="" aria-hidden="true" class="w-4 h-auto rounded-sm" loading="lazy" />
									<span class="squiggle-underline">stuckers</span>
								</span>
							</a>
						</div>
					</div>
				</div>
			</details>
		</div>
	</nav>
	<div class="mt-auto px-4 sm:px-5 pb-3 sm:pb-4 space-y-3">
		<WeatherToggle />
		<div 
			id="sidebar-info"
			class="hidden items-center justify-between text-xs border-t border-white/10 pt-3"
		>
			<a 
				href={repoUrl}
				target="_blank" 
				rel="noopener noreferrer"
				class="inline-flex items-center gap-2 text-white/60 hover:text-[var(--color-brand)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-brand)]/70 rounded-sm"
				aria-label="View source on GitHub"
			>
				<span aria-hidden="true" class="h-4 w-4 shrink-0 icon-github"></span>
				<span>crapshack.net</span>
			</a>
			<span class="text-white/40">v{version}</span>
		</div>
	</div>
</aside>

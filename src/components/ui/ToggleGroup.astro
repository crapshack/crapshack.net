---
interface Option {
	value: string;
	label: string;
}

interface Props {
	/** Unique name for the radio group */
	name: string;
	/** Array of options with value and label */
	options: Option[];
	/** Initially selected value */
	defaultValue?: string;
	/** Additional class for the container */
	class?: string;
}

const { name, options, defaultValue, class: className } = Astro.props;
const selectedValue = defaultValue ?? options[0]?.value;
---

<div
	class={`toggle-group ${className ?? ''}`}
	role="radiogroup"
	data-toggle-group={name}
>
	{options.map((option) => (
		<label class="toggle-option">
			<input
				type="radio"
				name={name}
				value={option.value}
				checked={option.value === selectedValue}
				class="sr-only"
			/>
			<span class="toggle-label">{option.label}</span>
		</label>
	))}
</div>

<script>
	// Bind only within this component instance to avoid duplicate listeners
	const scriptEl = document.currentScript;
	const group = scriptEl?.previousElementSibling as HTMLElement | null;

	if (group && group.matches('[data-toggle-group]') && !group.dataset.tgBound) {
		group.dataset.tgBound = 'true';
		const radios = group.querySelectorAll<HTMLInputElement>('input[type="radio"]');

		radios.forEach((radio) => {
			radio.addEventListener('change', () => {
				if (radio.checked) {
					group.dispatchEvent(
						new CustomEvent('toggle-change', {
							detail: { value: radio.value },
							bubbles: true,
						})
					);
				}
			});
		});
	}
</script>

---
import Layout from '../layouts/Layout.astro';
import Dialog from '../components/ui/Dialog.astro';
import ToggleGroup from '../components/ui/ToggleGroup.astro';
import { Package } from '@lucide/astro';

const repoUrl = 'https://github.com/crapshack/BitDream';
const issuesUrl = 'https://github.com/crapshack/BitDream/issues';
const releasesUrl = 'https://github.com/crapshack/BitDream/releases';
const rpcSpecUrl = 'https://github.com/transmission/transmission/blob/main/docs/rpc-spec.md';
const transmissionUrl = 'https://transmissionbt.com/';
const iconUrl = '/images/bitdream/bitdream.png';
const screenshotLight = '/images/bitdream/screen-grab-light.png';
const screenshotDark = '/images/bitdream/screen-grab-dark.png';
---

<Layout title="BitDream"
    title="crapshack (bitdream)"
    ogImage="/open-graph/bitdream.png"
    noIndex={true}
>
	<section class="mx-auto max-w-3xl space-y-8 mt-10">
		<header class="flex items-center gap-4">
			<img src={iconUrl} alt="BitDream icon" width="96" height="96" class="rounded-2xl drop-shadow-md" loading="lazy" />
			<div>
				<h1 class="text-3xl font-mono font-semibold bg-gradient-to-r from-[var(--color-brand)] to-white bg-clip-text text-transparent">BitDream</h1>
				<p class="text-white/90">A native, feature-rich remote control client for Transmission web server.</p>
			</div>
		</header>

		<div class="flex flex-wrap gap-3">
			<a href={repoUrl} target="_blank" rel="noopener noreferrer" class="inline-flex items-center rounded-md bg-[var(--color-brand)] px-4 py-2 font-medium hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-brand)]/70">
				<img src="/images/github-mark.svg" alt="" aria-hidden="true" class="mr-2 h-4 w-4" />
				<span>view on github</span>
			</a>
			<a href={releasesUrl} target="_blank" rel="noopener noreferrer" class="inline-flex items-center rounded-md border border-white/20 px-4 py-2 font-medium text-[var(--color-text)] hover:text-[var(--color-brand)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-brand)]/70">
				<Package width={16} height={16} stroke-width={2} class="mr-2" />
				releases
			</a>
			<a href={issuesUrl} target="_blank" rel="noopener noreferrer" class="inline-flex items-center rounded-md border border-white/20 px-4 py-2 font-medium text-[var(--color-text)] hover:text-[var(--color-brand)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-brand)]/70">
				support / issues
			</a>
		</div>

		<div class="screenshots grid grid-cols-1 sm:grid-cols-2 gap-4">
			<button
				type="button"
				class="screenshot-trigger group relative rounded-xl overflow-hidden border border-white/10 shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-brand)]"
				data-screenshot-trigger
				data-src={screenshotLight}
				data-alt="BitDream (light mode)"
			>
				<img src={screenshotLight} alt="BitDream (light mode)" class="w-full h-auto opacity-0 transition-all duration-300 group-hover:scale-[1.02]" data-screenshot loading="lazy" />
			</button>
			<button
				type="button"
				class="screenshot-trigger group relative rounded-xl overflow-hidden border border-white/10 shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-brand)]"
				data-screenshot-trigger
				data-src={screenshotDark}
				data-alt="BitDream (dark mode)"
			>
				<img src={screenshotDark} alt="BitDream (dark mode)" class="w-full h-auto opacity-0 transition-all duration-300 group-hover:scale-[1.02]" data-screenshot loading="lazy" />
			</button>
		</div>

		<Dialog
			id="screenshot-dialog"
			maxWidth="max-w-4xl"
			ariaLabel="BitDream screenshot dialog"
		>
			<img id="screenshot-dialog-img" src="" alt="" class="w-full h-auto rounded-lg" />
			<div class="flex justify-center">
				<ToggleGroup
					name="screenshot-mode"
					options={[
						{ value: 'light', label: 'light' },
						{ value: 'dark', label: 'dark' },
					]}
					defaultValue="light"
					ariaLabel="Screenshot mode"
				/>
			</div>
		</Dialog>

		<section class="space-y-3">
			<h2 class="text-2xl font-mono font-semibold text-[var(--color-text)]"># Features</h2>
			<ul class="list-disc pl-6 space-y-1 text-white/95">
				<li>Fully native apps for both macOS and iOS</li>
				<li>Remote management of Transmission server</li>
				<li>Real-time torrent status monitoring</li>
				<li>Add, remove, and manage torrents remotely</li>
				<li>View detailed torrent information and statistics</li>
				<li>Secure connection to Transmission's RPC interface</li>
			</ul>
		</section>

		<section class="space-y-3">
			<h2 class="text-2xl font-mono font-semibold text-[var(--color-text)]"># About Transmission</h2>
			<p class="text-white/95">
				<a class="underline decoration-[var(--color-brand)] underline-offset-4 hover:text-[var(--color-brand)]" href={transmissionUrl} target="_blank" rel="noopener noreferrer">Transmission</a>
				is a fast, easy, and free BitTorrent client for macOS, Windows, and Linux.
			</p>
			<p class="text-white/95">
				BitDream connects to Transmission's RPC (Remote Procedure Call) interface, allowing you to control your Transmission server from anywhere. Learn more in the
				<a class="underline decoration-[var(--color-brand)] underline-offset-4 hover:text-[var(--color-brand)]" href={rpcSpecUrl} target="_blank" rel="noopener noreferrer">official RPC specification</a>.
			</p>
		</section>
	</section>
</Layout>

<script>
	import { openDialog } from '../lib/ui/dialog';

	const screenshots = document.querySelectorAll<HTMLImageElement>('[data-screenshot]');
	screenshots.forEach((img, i) => {
		const fadeIn = () => {
			setTimeout(() => {
				img.classList.remove('opacity-0');
				img.classList.add('opacity-100');
			}, i * 100);
		};
		if (img.complete) {
			fadeIn();
		} else {
			img.addEventListener('load', fadeIn, { once: true });
		}
	});

	const screenshotTriggers = document.querySelectorAll<HTMLButtonElement>('[data-screenshot-trigger]');
	const dialogImg = document.getElementById('screenshot-dialog-img') as HTMLImageElement | null;
	const toggleGroup = document.querySelector<HTMLElement>('[data-toggle-group="screenshot-mode"]');

	const screenshotSources: Record<string, { src: string; alt: string }> = {
		light: { src: '/images/bitdream/screen-grab-light.png', alt: 'BitDream (light mode)' },
		dark: { src: '/images/bitdream/screen-grab-dark.png', alt: 'BitDream (dark mode)' },
	};

	function setScreenshot(mode: string) {
		if (!dialogImg) return;
		const source = screenshotSources[mode];
		if (source) {
			dialogImg.src = source.src;
			dialogImg.alt = source.alt;
		}
	}

	function setToggleValue(name: string, value: string) {
		const radio = document.querySelector<HTMLInputElement>(
			`[data-toggle-group="${name}"] input[value="${value}"]`
		);
		if (radio) {
			radio.checked = true;
		}
	}

	screenshotTriggers.forEach((trigger) => {
		trigger.addEventListener('click', () => {
			const src = trigger.dataset.src;
			const alt = trigger.dataset.alt;
			if (dialogImg && src) {
				dialogImg.src = src;
				dialogImg.alt = alt ?? '';

				const mode = src.includes('light') ? 'light' : 'dark';
				setToggleValue('screenshot-mode', mode);

				openDialog('screenshot-dialog');
			}
		});
	});

	toggleGroup?.addEventListener('toggle-change', ((e: CustomEvent<{ value: string }>) => {
		setScreenshot(e.detail.value);
	}) as EventListener);
</script>
